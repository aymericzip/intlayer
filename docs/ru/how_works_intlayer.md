# Как работает Intlayer

## Обзор

Роль Intlayer заключается в интерпретации файлов декларации контента JavaScript в словари.

Для этого Intlayer проходит несколько этапов:

1. Декларация файлов контента

   - Файлы контента могут быть определены в различных форматах, таких как TypeScript, ECMAScript, CommonJS или JSON.
   - Файлы контента могут быть определены в любом месте проекта, что позволяет лучше поддерживать и масштабировать проект. Важно соблюдать соглашения об расширениях файлов для файлов контента. Это расширение по умолчанию `*.content.{js|cjs|mjs|ts|tsx|json}`, но его можно изменить в [файле конфигурации](https://github.com/aymericzip/intlayer/blob/main/docs/ru/configuration.md).

2. Генерация словарей

   - Словари генерируются из файлов контента. По умолчанию словари intlayer генерируются в директории `.intlayer/dictionary` проекта.
   - Можно генерировать два типа словарей: словари intlayer и словари i18n (бета).

3. Генерация типов словарей

   - Типы словарей генерируются из словарей intlayer. По умолчанию типы словаря intlayer генерируются в директории `types` проекта.

4. Генерация расширения модуля Intlayer

   - Расширение [модуля Intlayer](https://www.typescriptlang.org/docs/handbook/declaration-merging.html) — это функция TypeScript, которая позволяет вам определять дополнительные типы для Intlayer. Это облегчает разработку, предлагая доступные или обязательные аргументы.
     Среди сгенерированных типов типы словарей intlayer или даже типы конфигурации языка добавляются в файл `types/intlayer.d.ts` и используются другими пакетами. Для этого необходимо, чтобы файл `tsconfig.json` был настроен для включения директории `types` проекта.

5. Мониторинг файлов контента

   - Файлы контента отслеживаются для повторной генерации каждый раз, когда они модифицируются.

6. Интерпретация словарей
   - Наконец, словари интерпретируются для использования в приложениях.

## Пакеты

Intlayer состоит из нескольких пакетов, каждый из которых выполняет конкретную роль в процессе перевода. Вот графическое представление структуры этого пакета:

![packages of intlayer](https://github.com/aymericzip/intlayer/blob/main/docs/assets/packages_dependency_graph.svg)

### intlayer

Пакет `intlayer` используется в приложениях для декларации контента в файлах контента.

### react-intlayer

Пакет `react-intlayer` используется для интерпретации словарей intlayer и их использования в React-приложениях.

### next-intlayer

Пакет `next-intlayer` используется как слой поверх `react-intlayer`, чтобы сделать словари intlayer используемыми в приложениях Next.js. Он интегрирует важные функции для работы Intlayer в среде Next.js, такие как промежуточное программное обеспечение перевода, маршрутизация или конфигурация файла `next.config.js`.

### intlayer-editor

Пакет `intlayer-editor` используется для предоставления возможности визуального редактора. Этот необязательный пакет может быть установлен в приложениях и будет использоваться пакетом `react-intlayer`.
Он состоит из двух частей: сервера и клиента.

Клиент содержит элементы пользовательского интерфейса, которые будут использоваться `react-intlayer`.

Сервер, основанный на Express, используется для получения визуальных запросов редактора и управления или изменения файлов контента.

### intlayer-cli

Пакет `intlayer-cli` может использоваться для генерации словарей с помощью команды `npx intlayer build`. Если `intlayer` уже установлен, cli автоматически устанавливается и этот пакет не нужен.

### @intlayer/core

Пакет `@intlayer/core` является мастер-пакетом Intlayer. Он содержит функции управления переводом и словарями. `@intlayer/core` является многоплатформенным и используется другими пакетами для выполнения интерпретации словарей.

### @intlayer/config

Пакет `@intlayer/config` используется для настройки параметров Intlayer, таких как доступные языки, параметры промежуточного программного обеспечения Next.js или настройки встроенного редактора.

### @intlayer/webpack

Пакет `@intlayer/webpack` используется для добавления плагинов компиляции в Next.js и React.

### @intlayer/cli

Пакет `@intlayer/cli` используется для обеспечения единого стиля всех команд intlayer CLI.

### @intlayer/dictionaries-entry

Пакет `@intlayer/dictionaries-entry` — это пакет, который только возвращает путь к словарям intlayer. Поскольку поиск файловой системы невозможен из браузера, использование пакетировщиков, таких как Webpack или Rollup, для получения пути к словарям невозможно. Этот пакет предназначен для псевдонима.

### @intlayer/chokidar

Пакет `@intlayer/chokidar` используется для мониторинга файлов контента и повторной генерации измененного словаря при каждом изменении.
